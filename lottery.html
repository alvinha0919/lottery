<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>簡易抽獎工具</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #f6f9ff, #e3f2fd);
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      border-radius: 16px;
      padding: 24px 28px 28px;
      width: 100%;
      max-width: 520px;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 24px;
      text-align: center;
      color: #1e293b;
    }

    p.desc {
      margin: 0 0 16px;
      font-size: 13px;
      color: #64748b;
      text-align: center;
    }

    label {
      display: block;
      font-size: 14px;
      color: #0f172a;
      margin-bottom: 6px;
      font-weight: 600;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      border-radius: 10px;
      border: 1px solid #cbd5f5;
      padding: 10px 12px;
      font-size: 14px;
      resize: vertical;
      box-sizing: border-box;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.2);
    }

    .hint {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 18px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .count {
      font-size: 13px;
      color: #475569;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    #drawBtn {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #fff;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
    }

    #drawBtn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 3px 10px rgba(37, 99, 235, 0.3);
    }

    #clearBtn {
      background: #e2e8f0;
      color: #0f172a;
    }

    #clearBtn:active {
      transform: translateY(1px) scale(0.99);
    }

    .result-box {
      margin-top: 20px;
      border-radius: 14px;
      padding: 14px 16px;
      background: #f8fafc;
      border: 1px dashed #cbd5f5;
    }

    .result-title {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 6px;
    }

    .result-value {
      font-size: 22px;
      font-weight: 700;
      color: #16a34a;
      word-break: break-word;
      min-height: 1.4em;
    }

    .error {
      margin-top: 10px;
      font-size: 13px;
      color: #dc2626;
      display: none;
    }

    .wheel-section {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .wheel-title {
      font-size: 14px;
      color: #0f172a;
      font-weight: 600;
    }

    .wheel-wrapper {
      position: relative;
      width: 260px;
      height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #wheelCanvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.2);
      background: #e2e8f0;
    }

    .pointer {
      position: absolute;
      top: -4px;
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 18px solid #f97316;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.25));
    }

    .wheel-center-cap {
      position: absolute;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: #ffffff;
      border: 2px solid #e2e8f0;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.15) inset;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>抽抽小工具</h1>
    <p class="desc">每一行輸入一個名字或選項，按下「開始抽獎」隨機選出一間/一處。</p>

    <label for="inputArea">參加名單 / 選項</label>
    <textarea id="inputArea" placeholder="例如：
小明
小美
小華
獎品 A
獎品 B"></textarea>
    <div class="hint">提示：空白行會自動忽略。</div>

    <div class="wheel-section">
      <div class="wheel-title">抽啊抽</div>
      <div class="wheel-wrapper">
        <canvas id="wheelCanvas" width="300" height="300"></canvas>
        <div class="pointer"></div>
        <div class="wheel-center-cap"></div>
      </div>
    </div>

    <div class="actions">
      <span class="count" id="countLabel">目前有效項目：0 個</span>
      <div>
        <button id="clearBtn" type="button">清空</button>
        <button id="drawBtn" type="button">開始抽獎</button>
      </div>
    </div>

    <div class="result-box">
      <div class="result-title">抽到的是：</div>
      <div class="result-value" id="resultText">（尚未抽獎）</div>
    </div>

    <div class="error" id="errorText">請先輸入至少一個有效項目再抽獎。</div>
  </div>

  <script>
    const inputArea = document.getElementById('inputArea');
    const countLabel = document.getElementById('countLabel');
    const resultText = document.getElementById('resultText');
    const errorText = document.getElementById('errorText');
    const drawBtn = document.getElementById('drawBtn');
    const clearBtn = document.getElementById('clearBtn');
    const wheelCanvas = document.getElementById('wheelCanvas');
    const wheelCtx = wheelCanvas && wheelCanvas.getContext ? wheelCanvas.getContext('2d') : null;

    let currentRotation = 0;
    let spinning = false;

    const wheelColors = [
      '#fee2e2',
      '#ffedd5',
      '#fef9c3',
      '#dcfce7',
      '#dbeafe',
      '#e0e7ff',
      '#fce7f3',
      '#f5f5f5'
    ];

    function getValidItems() {
      // 依照換行分割，去除空白，過濾掉空行
      return inputArea.value
        .split('\n')
        .map(t => t.trim())
        .filter(t => t.length > 0);
    }

    function drawWheel(items, rotation = currentRotation) {
      if (!wheelCtx) return;

      const size = wheelCanvas.width;
      const radius = size / 2 - 8;
      const cx = size / 2;
      const cy = size / 2;

      wheelCtx.clearRect(0, 0, size, size);

      wheelCtx.save();
      wheelCtx.translate(cx, cy);
      // 讓 0 角度對準上方
      wheelCtx.rotate(rotation - Math.PI / 2);

      const count = items.length;

      if (count === 0) {
        wheelCtx.beginPath();
        wheelCtx.fillStyle = '#e2e8f0';
        wheelCtx.arc(0, 0, radius, 0, Math.PI * 2);
        wheelCtx.fill();

        wheelCtx.fillStyle = '#64748b';
        wheelCtx.font = '14px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
        wheelCtx.textAlign = 'center';
        wheelCtx.textBaseline = 'middle';
        wheelCtx.fillText('請先輸入', 0, -6);
        wheelCtx.fillText('抽獎項目', 0, 12);

        wheelCtx.restore();
        return;
      }

      const angleStep = (Math.PI * 2) / count;

      for (let i = 0; i < count; i++) {
        const startAngle = i * angleStep;
        const endAngle = startAngle + angleStep;

        // 扇形底色
        wheelCtx.beginPath();
        wheelCtx.moveTo(0, 0);
        wheelCtx.fillStyle = wheelColors[i % wheelColors.length];
        wheelCtx.arc(0, 0, radius, startAngle, endAngle);
        wheelCtx.closePath();
        wheelCtx.fill();

        // 文字
        const label = items[i].length > 10 ? items[i].slice(0, 9) + '…' : items[i];
        const middleAngle = startAngle + angleStep / 2;

        wheelCtx.save();
        wheelCtx.rotate(middleAngle);
        wheelCtx.translate(radius * 0.65, 0);
        wheelCtx.rotate(Math.PI / 2);

        wheelCtx.fillStyle = '#0f172a';
        wheelCtx.font = 'bold 12px system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
        wheelCtx.textAlign = 'center';
        wheelCtx.textBaseline = 'middle';
        wheelCtx.fillText(label, 0, 0);

        wheelCtx.restore();
      }

      // 中心圓 (與 CSS 的 center cap 搭配)
      wheelCtx.beginPath();
      wheelCtx.fillStyle = 'rgba(255,255,255,0.4)';
      wheelCtx.arc(0, 0, 26, 0, Math.PI * 2);
      wheelCtx.fill();

      wheelCtx.restore();
    }

    function updateCount() {
      const items = getValidItems();
      countLabel.textContent = `目前有效項目：${items.length} 個`;
       if (!spinning) {
         drawWheel(items, currentRotation);
       }
    }

    inputArea.addEventListener('input', () => {
      updateCount();
      errorText.style.display = 'none';
    });

    drawBtn.addEventListener('click', () => {
      const items = getValidItems();
      if (items.length === 0) {
        errorText.style.display = 'block';
        resultText.textContent = '（尚未抽獎）';
        return;
      }

      if (spinning) {
        return;
      }

      errorText.style.display = 'none';
      spinning = true;
      drawBtn.disabled = true;
      drawBtn.textContent = '抽獎中…';

      const startRotation = currentRotation;
      const extraTurns = 4 + Math.random() * 2; // 4~6 圈
      const randomOffset = Math.random() * Math.PI * 2;
      const targetRotation = startRotation + extraTurns * Math.PI * 2 + randomOffset;
      const duration = 4000;
      let startTime = null;

      function animateFrame(timestamp) {
        if (!startTime) startTime = timestamp;
        const elapsed = timestamp - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3); // ease-out

        const angle = startRotation + (targetRotation - startRotation) * eased;
        drawWheel(items, angle);

        if (progress < 1) {
          requestAnimationFrame(animateFrame);
        } else {
          currentRotation = targetRotation;

          // 計算指針所指向的扇形
          const segmentAngle = (Math.PI * 2) / items.length;
          const pointerLocalAngle = currentRotation; // 上方指針轉回圓盤座標
          let normalized = pointerLocalAngle % (Math.PI * 2);
          if (normalized < 0) normalized += Math.PI * 2;
          const index = Math.floor(normalized / segmentAngle);

          resultText.textContent = items[index];
          spinning = false;
          drawBtn.disabled = false;
          drawBtn.textContent = '開始抽獎';
        }
      }

      requestAnimationFrame(animateFrame);
    });

    clearBtn.addEventListener('click', () => {
      inputArea.value = '';
      updateCount();
      resultText.textContent = '（尚未抽獎）';
      errorText.style.display = 'none';
    });

    // 初始化
    updateCount();
  </script>
</body>
</html>